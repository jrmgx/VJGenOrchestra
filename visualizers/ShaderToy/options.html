<!DOCTYPE html>
<html>
<head><meta charset="utf-8"></head>
<body>
  <label>Shader <select name="shader" id="shader-select"></select></label>
  <label>Quality <select name="quality"><option value="low">Low (320)</option><option value="med" selected>Med (640)</option><option value="hi">Hi (1024)</option></select></label>
  <label><input type="checkbox" name="keepAspectRatio" checked> Keep aspect ratio</label>
  <label>Speed <input type="range" name="speed" min="0.5" max="2" step="0.1" value="1"></label>
  <script>
    (function() {
      var STORAGE_KEY = 'shadertoy-options';
      function getOptions() {
        var opts = {};
        document.querySelectorAll('input, select').forEach(function(el) {
          var k = el.name || el.id;
          if (!k) return;
          if (el.type === 'checkbox') opts[k] = el.checked;
          else if (el.type === 'range' || el.type === 'number') opts[k] = parseFloat(el.value) || 0;
          else opts[k] = el.value;
        });
        return opts;
      }
      function applyOptions(opts) {
        if (!opts) return;
        document.querySelectorAll('input, select').forEach(function(el) {
          var k = el.name || el.id;
          if (!k || !(k in opts)) return;
          var v = opts[k];
          if (el.type === 'checkbox') el.checked = !!v;
          else if (el.type === 'range' || el.type === 'number') el.value = String(v);
          else el.value = v;
        });
      }
      function save() {
        try { localStorage.setItem(STORAGE_KEY, JSON.stringify(getOptions())); } catch (e) {}
      }
      function load() {
        try {
          var s = localStorage.getItem(STORAGE_KEY);
          if (s) applyOptions(JSON.parse(s));
        } catch (e) {}
      }
      document.addEventListener('change', function() { save(); });
      document.addEventListener('input', function() { save(); });
      load();
      fetch(new URL('../../assets/shadertoy/manifest.json', window.location.href).href + '?t=' + Date.now())
        .then(function(r) { return r.ok ? r.json() : []; })
        .then(function(list) {
          var sel = document.getElementById('shader-select');
          var saved = (function() { try { var s = localStorage.getItem(STORAGE_KEY); return s ? JSON.parse(s) : null; } catch(e) { return null; } })();
          var current = saved && saved.shader ? saved.shader : (list.length ? list[0] : null);
          sel.innerHTML = list.map(function(f) { return '<option value="' + f + '">' + f + '</option>'; }).join('');
          if (current && list.indexOf(current) >= 0) sel.value = current;
          else if (list.length) sel.selectedIndex = 0;
          applyOptions(saved);
          sel.dispatchEvent(new Event('change', { bubbles: true }));
        })
        .catch(function() {});
    })();
  </script>
</body>
</html>
