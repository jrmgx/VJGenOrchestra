<!DOCTYPE html>
<html>
<head><meta charset="utf-8">
<style>
.video-selector { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 0.5rem 0; }
.video-selector button { padding: 0; border: 2px solid #444; background: #222; cursor: pointer; border-radius: 4px; overflow: hidden; }
.video-selector button:hover { border-color: #666; }
.video-selector button.selected { border-color: #0af; }
.video-selector button img { display: block; width: 80px; height: 45px; object-fit: cover; }
</style>
</head>
<body>
  <label>Video</label>
  <div class="video-selector" id="videoSelector">
    <input type="hidden" name="video" id="videoInput" value="">
  </div>
  <label>Min speed <input type="range" name="minSpeed" min="1" max="5" step="0.5" value="1"></label>
  <label>Max speed <input type="range" name="maxSpeed" min="1" max="5" step="0.5" value="5"></label>
  <label>Boost (beats) <input type="range" name="boostBeats" min="0.1" max="2" step="0.1" value="0.5"></label>
  <script>
(function() {
  const container = document.getElementById("videoSelector");
  const input = document.getElementById("videoInput");
  const base = new URL(".", document.baseURI).href;
  const t = new URL(document.URL).searchParams.get("t") || Date.now();
  const videosUrl = new URL("../../assets/videos/videos.json?t=" + t, document.baseURI).href;

  function thumbUrl(v) {
    return base + "../../" + (v.thumb || v.path.replace(".mp4", "-thumb.jpg"));
  }

  function syncSelection() {
    const v = input.value;
    container.querySelectorAll("button").forEach(btn => {
      btn.classList.toggle("selected", btn.dataset.value === v);
    });
  }

  function init(videos) {
    videos.forEach((v) => {
      const btn = document.createElement("button");
      btn.type = "button";
      btn.dataset.value = v.path;
      const img = document.createElement("img");
      img.src = thumbUrl(v);
      img.alt = v.path.split("/").pop();
      btn.appendChild(img);
      btn.addEventListener("click", () => {
        input.value = btn.dataset.value;
        input.dispatchEvent(new Event("change", { bubbles: true }));
        syncSelection();
      });
      container.appendChild(btn);
    });
    if (videos.length && !input.value) input.value = videos[0].path;
    document.addEventListener("optionsApplied", syncSelection);
    syncSelection();
  }

  fetch(videosUrl).then(r => r.json()).then(init).catch(() => init([]));
})();
  </script>
</body>
</html>
